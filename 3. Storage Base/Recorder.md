# Recorder 日志记录仪

用于持久化记录数据的接口，理论上支持多种后端实现。

## Recorder 日志记录仪

### 支持接口

#### open()

根据 ID 获取日志介质

##### 接受参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| id | String | 日志介质 ID |
| truncate | bool | 是否截断文件 |

##### 返回参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| medium | RecordMedium | 返回日志记录介质 |
| error | IOError | IO 错误信息 |

#### delete()

根据 ID 删除日志介质

##### 接受参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| id | String | 日志介质 ID |

##### 返回参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| error | IOError | IO 错误信息 |

## RecordMedium 日志记录介质

### 支持接口

RecordMedium 的接口模仿一个文件的接口，支持 `read()`，`write()`，`flush()`，`close()` 等操作，接口细节与编程语言相关，这里省略。

## FileSystemRecorder 基于文件系统的日志记录仪

基于文件系统实现 Recorder 接口

| 名称       | 类型       | 描述                                               |
| ---------- | ---------- | -------------------------------------------------- |
| root_directory | Path | 日志存储所在根目录 |

### 支持接口

#### open()

根据 ID 获取日志介质

##### 接受参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| id | String | 日志 ID |
| truncate | bool | 是否截断文件 |

##### 返回参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| medium | RecordMedium | 返回日志记录介质 |
| error | IOError | IO 错误信息 |

##### 伪代码实现

```
mode = O_CREATE
if truncate {
	mode |= O_WRONLY | O_TRUNC
} else {
	mode |= O_RDONLY | O_APPEND
}
open(root_directory.add(id), mode)
```

#### delete()

根据 ID 删除日志介质

##### 接受参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| id | String | 日志 ID |

##### 返回参数

| 名称    | 类型    | 描述                  |
| ------- | ------- | --------------------- |
| error | IOError | IO 错误信息 |

##### 伪代码实现

```
rm(root_directory.add(id))
```